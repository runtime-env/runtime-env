# runtime-env

> **The twelve-factor app stores config in _environment variables_** (often shortened to env vars or env). Env vars are easy to change between deploys without changing any code. - [The Twelve-Factor App](https://12factor.net/config)

## Feature

- **ðŸ”’ Security First** - No environment variables will be exposed to clients unless you define it in a .env.example file.

- **âœ… Compile Safe** - No more forgetting to provide environment variables. Using runtime-env, if your code compiles, it works.

- **ðŸš€ Save Time** - Speed up your CI/CD pipeline, you no longer need to build multiple bundles for different stages.

## Getting Started

1. Install CLI:

   ```sh
   $ npm i @runtime-env/cli -D
   ```

1. Define which environment variables to be loaded:

   `.env.example`:

   ```ini
   FOO=
   ```

1. Configure runtime-env:

   Example configuration:

   `.runtimeenvrc.json`

   ```json
   {
     "globalVariableName": "runtimeEnv",
     "genJs": [
       {
         "mode": "development",
         "envExampleFilePath": ".env.example",
         "envFilePath": ".env",
         "userEnvironment": false,
         "outputFilePath": "public/runtime-env.js"
       },
       {
         "mode": "test",
         "envExampleFilePath": ".env.example",
         "envFilePath": ".env",
         "userEnvironment": false,
         "outputFilePath": "jest-setup-file-runtime-env.js"
       },
       {
         "mode": "production",
         "envExampleFilePath": ".env.example",
         "envFilePath": null,
         "userEnvironment": true,
         "outputFilePath": "dist/runtime-env.js"
       }
     ],
     "genTs": {
       "envExampleFilePath": ".env.example",
       "outputFilePath": "src/runtime-env.d.ts"
     }
   }
   ```

1. Generate `runtime-env.js`:

   - Development mode example:

     ```sh
     $ echo "FOO=development" > .env
     $ runtime-env gen-js --mode development
     ```

     Example output:

     `runtime-env.js`

     ```js
     // Generated by '@runtime-env/cli'

     globalThis.runtimeEnv = {
       FOO: "development",
     };
     ```

   - Production mode example:

     ```sh
     $ export FOO=production
     $ runtime-env gen-js --mode production
     ```

     Example output:

     `dist/runtime-env.js`

     ```js
     // Generated by '@runtime-env/cli'

     globalThis.runtimeEnv = {
       FOO: "production",
     };
     ```

     In order to run `runtime-env` in a production environment, you may also need to package the `runtime-env` into a standalone executable, in which case you can use a tool such as [pkg](https://npmjs.com/pkg) to do this, for example:

     ```sh
     $ pkg ./node_modules/@runtime-env/cli/bin/runtime-env.js --target node18-alpine-x64 --output runtime-env-alpine
     ```

     Then run it like we did before:

     ```sh
     $ runtime-env-alpine gen-js --mode production
     ```

1. Generate `runtime-env.d.ts`:

   ```sh
   $ runtime-env gen-ts
   ```

   Example output:

   `runtime-env.d.ts`

   ```ts
   // Generated by '@runtime-env/cli'

   declare const runtimeEnv: {
     readonly FOO: string;
   };
   ```

1. Load `runtime-env.js`:

   - Development mode example:

     `index.html`

     ```html
     <script src="/runtime-env.js"></script>
     ```

   - Test mode example:

     `jest.config.js`

     ```js
     export default {
       setupFiles: ["<rootDir>/jest/setup-files/runtime-env.js"],
     };
     ```

1. Use it:

   ```ts
   console.log(runtimeEnv.FOO);
   ```

## Configuration

### Configuration File

We use [cosmiconfig](https://www.npmjs.com/package/cosmiconfig#searchplaces) to load config from your root directory:

runtime-env uses [cosmiconfig](https://www.npmjs.com/package/cosmiconfig) for configuration file support. Here is some example places you can configure:

1. A `runtimeenv` key in your package.json file.
1. A `.runtimeenvrc` file written in JSON or YAML.
1. A `.runtimeenvrc.json` file.

Visit [here](https://www.npmjs.com/package/cosmiconfig#searchplaces) to see all available places to configure (replace `moduleName` with `runtimeenv`).

### Options

| Default                                  | Path                         | Type               | Description                                                                                                                                                                   |
| ---------------------------------------- | ---------------------------- | ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| _required_                               | `globalVariableName`         | `string`           |                                                                                                                                                                               |
| _required_                               | `genJs`                      | `array`            |                                                                                                                                                                               |
| _required_                               | `genJs.*`                    | `object`           |                                                                                                                                                                               |
| _required_                               | `genJs.*.mode`               | `string`           | Instruct the CLI which configuration to use                                                                                                                                   |
| _required_                               | `genJs.*.envExampleFilePath` | `string`           |                                                                                                                                                                               |
| `null`                                   | `genJs.*.envFilePath`        | `null` \| `string` | Leave `null` to mean no env files are loaded                                                                                                                                  |
| _required_                               | `genJs.*.userEnvironment`    | `boolean`          | Indicates whether environment variables should be loaded from `process.env`. `process.env.*` takes precedence over the environment variables loaded via `genJs.*.envFilePath` |
| _required_                               | `genJs.*.outputFilePath`     | `string`           |                                                                                                                                                                               |
| _required if running `--gen-ts` command_ | `genTs`                      | object             |                                                                                                                                                                               |
| _required_                               | `genTs.envExampleFilePath`   | string             |                                                                                                                                                                               |
| _required_                               | `genTs.outputFilePath`       | string             |                                                                                                                                                                               |

## Further Setup

- You MUST configure your web server to prevent caching of `runtime-env.js`.

- If you are building PWA, you MUST to configure your ServiceWorker to use proper approach for caching `runtime-env.js` file.
